angular.module("rectNG",[]).directive("rectng",function(){return{restrict:"E",scope:{},controller:["$scope","$element","$attrs",function(e,t,a){e.lastSelectIndex=-1,e.sortAscending=!0,e.lastSortIndex=-1,e.visibleData=[],e.visibleModel=[],e.multiselect=!0,e.showPager=!0,e.currentPage=1,e.availableItemsPerPage=[25,50,100,200,500],e.itemsPerPage=100,e.showPageInputBox=!1,e.cellClick=function(t,l){if(void 0==e.multiselect||0==e.multiselect){for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!1;e.visibleData[t].selected=!0,e.lastSelectIndex=t;var i,n=[];return i=e.cloneObj(e.visibleData[t]),delete i.selected,n.push(i),a.selectedRows&&""!=a.selectedRows&&(e.$parent[a.selectedRows]=[e.visibleData[t]]),void 0}var i,n=[];if(l.shiftKey)if(-1==e.lastSelectIndex){for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!1;e.visibleData[t].selected=!0,i=e.cloneObj(e.visibleData[r]),delete i.selected,n.push(i)}else if(t>e.lastSelectIndex)for(var r=e.lastSelectIndex;t>=r;r++)e.visibleData[r].selected=!0,i=e.cloneObj(e.visibleData[r]),delete i.selected,n.push(i);else for(var r=t;r<=e.lastSelectIndex;r++)e.visibleData[r].selected=!0,i=e.cloneObj(e.visibleData[r]),delete i.selected,n.push(i);else if(l.ctrlKey||l.metaKey){e.visibleData[t].selected=!e.visibleData[t].selected;for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected&&(i=e.cloneObj(e.visibleData[r]),delete i.selected,n.push(i))}else{for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!1;e.visibleData[t].selected=!0,i=e.cloneObj(e.visibleData[t]),delete i.selected,n.push(i)}e.lastSelectIndex=t,a.selectedRows&&""!=a.selectedRows&&(e.$parent[a.selectedRows]=n)},e.sortBy=function(t,a){t>=e.visibleModel.length||(t!=e.lastSortIndex||a||(e.sortAscending=!e.sortAscending),e.data.sort(e.sortFunction(e.visibleModel[t].id,e.sortAscending)),e.lastSortIndex=t,e.updateVisibleData())},e.updateVisibleModel=function(){for(var t=[],a=0;a<e.columns.length;a++)(void 0===e.columns[a].visible||e.columns[a].visible===!0)&&t.push(e.columns[a]);e.visibleModel=t},e.updateVisibleData=function(){e.visibleData=[];var t=(e.currentPage-1)*e.itemsPerPage;if(void 0==e.filter||""==e.filter)for(var a=e.itemsPerPage<e.data.length-t?e.itemsPerPage:e.data.length-t,l=0;a>l;l++)e.visibleData.push(e.data[t+l]);else{for(var r=[],i=new RegExp(e.filter,"i"),l=0;l<e.data.length;l++){for(var n="",s=0;s<e.columns.length;s++)n+=e.data[l][e.columns[s].id]+" ";if(i.test(n)&&(r.push(e.data[l]),r.length>=t+e.itemsPerPage))break}for(var a=e.itemsPerPage<r.length-t?e.itemsPerPage:r.length-t,l=0;a>l;l++)e.visibleData.push(r[t+l])}},e.countVisibleEntries=function(){if(void 0==e.filter||""==e.filter)return e.data.length;for(var t,a=0,l=new RegExp(e.filter,"i"),r=0;r<e.data.length;r++){t="";for(var i=0;i<e.columns.length;i++)t+=e.data[r][e.columns[i].id]+" ";l.test(t)&&a++}return a},e.countPages=function(){return Math.ceil(e.countVisibleEntries()/e.itemsPerPage)},e.nextPage=function(){var t=e.countPages();e.currentPage+1>t?e.currentPage=t:e.currentPage++,e.updateVisibleData()},e.prevPage=function(){e.countPages();e.currentPage-1<1?e.currentPage=1:e.currentPage--,e.updateVisibleData()},e.toggleItemsPerPage=function(){var t=e.availableItemsPerPage.indexOf(e.itemsPerPage);t=(t+1)%e.availableItemsPerPage.length,e.itemsPerPage=e.availableItemsPerPage[t];var a=e.countPages();parseInt(e.currentPage)>a&&(e.currentPage=a),e.updateVisibleData()},e.toggleGotoPage=function(t){if(t&&"click"==t.type)e.showPageInputBox=!0,setTimeout(function(){t.target.parentNode.querySelector("input").focus(),setTimeout(function(){t.target.parentNode.querySelector("input").select()},50)},50);else if(t&&"keydown"==t.type&&13==t.keyCode||t&&"blur"==t.type){t.preventDefault(),e.showPageInputBox=!1;var a=e.countPages();e.currentPage=parseInt(e.currentPage)>a?a:parseInt(e.currentPage)<1?1:parseInt(e.currentPage),e.updateVisibleData()}},e.selectAll=function(){if(e.multiselect){var t,l=[];if(a.selectedRows&&""!=a.selectedRows){for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!0,t=e.cloneObj(e.visibleData[r]),delete t.selected,l.push(t);e.$parent[a.selectedRows]=l}else for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!0;e.lastSelectIndex=0}},e.selectNone=function(){if(e.multiselect){for(var t=0;t<e.visibleData.length;t++)e.visibleData[t].selected=!1;a.selectedRows&&""!=a.selectedRows&&(e.$parent[a.selectedRows]=[]),e.lastSelectIndex=0}},e.keyUp=function(t){e.lastSelectIndex>0?e.lastSelectIndex--:e.lastSelectIndex=0;for(var l=0;l<e.visibleData.length;l++)e.visibleData[l].selected=!1;e.visibleData[e.lastSelectIndex].selected=!0;for(var r=0,i=t.target.querySelector(".rectNG-body"),n=i.querySelectorAll(".rectNG-row"),l=0;l<e.lastSelectIndex&&l<n.length;l++)r+=n[l].offsetHeight;if(r<i.scrollTop&&(i.scrollTop=r),a.selectedRows&&""!=a.selectedRows){var s=e.cloneObj(e.visibleData[e.lastSelectIndex]);delete s.selected,e.$parent[a.selectedRows]=[s]}},e.keyDown=function(t){e.lastSelectIndex<e.visibleData.length-1?e.lastSelectIndex++:e.lastSelectIndex=e.visibleData.length-1;for(var l=0;l<e.visibleData.length;l++)e.visibleData[l].selected=!1;e.visibleData[e.lastSelectIndex].selected=!0;for(var r=0,i=0,n=t.target.querySelector(".rectNG-body"),s=n.querySelectorAll(".rectNG-row"),l=0;l<=e.lastSelectIndex&&l<s.length;l++)r+=s[l].offsetHeight,i=s[l].offsetHeight;if(r>=n.scrollTop+n.offsetHeight&&(n.scrollTop=r-n.offsetHeight),a.selectedRows&&""!=a.selectedRows){var c=e.cloneObj(e.visibleData[e.lastSelectIndex]);delete c.selected,e.$parent[a.selectedRows]=[c]}},e.onKey=function(t){"keydown"==t.type&&(t.metaKey&&65==t.keyCode||t.ctrlKey&&t.keyCode65?(t.preventDefault(),e.selectAll()):38==t.keyCode?(t.preventDefault(),e.keyUp(t)):40==t.keyCode&&(t.preventDefault(),e.keyDown(t)))},e.isRowSelected=function(t){return e.visibleData[t].selected?"rectNG-selected":""},e.columnWidth=function(){if(e.width.indexOf("%")>0)return 100/e.visibleModel.length+"%";var t=parseFloat(e.width);return t/e.visibleModel.length+"px"},e.$on("rectngSelectRow",function(t,l){if(!(0>l||l>=e.visibleData.length)){e.lastSelectIndex=l;for(var r=0;r<e.visibleData.length;r++)e.visibleData[r].selected=!1;if(e.visibleData[l].selected=!0,a.selectedRows){var i=e.cloneObj(e.visibleData[e.lastSelectIndex]);delete i.selected,e.$parent[a.selectedRows]=[i],e.$parent.$$phase||e.$parent.$digest()}e.$parent.$$phase||e.$$phase||e.$digest()}}),e.$on("rectngSelectAll",function(){e.selectAll(),e.$parent.$$phase||e.$$phase||e.$digest()}),e.$on("rectngSelectNone",function(){e.selectNone(),e.$parent.$$phase||e.$$phase||e.$digest()}),e.cloneObj=function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},e.sortFunction=function(e,t,a){var l=a?function(t){return a(t[e])}:function(t){return t[e]};return t=[-1,1][+!!t],function(e,a){return e=l(e),a=l(a),e||a?e?a?t*((e>a)-(a>e)):t:-t:0}},e.$watch(a.data,function(){e.$parent.$watch(a.data,function(){e.data=e.$parent.$eval(a.data)||[],-1==e.lastSortIndex?e.updateVisibleData():e.sortBy(e.lastSortIndex,!0)}),e.data=e.$parent.$eval(a.data)||[],-1==e.lastSortIndex?e.updateVisibleData():e.sortBy(e.lastSortIndex,!0)}),e.$watch(a.columns,function(){e.$parent.$watch(a.columns,function(){e.columns=e.$parent.$eval(a.columns)||[],e.updateVisibleModel()}),e.columns=e.$parent.$eval(a.columns)||[],e.updateVisibleModel()}),e.$watch(a.filter,function(){e.$parent.$watch(a.filter,function(){e.filter=e.$parent.$eval(a.filter)||"",e.updateVisibleData()}),e.filter=e.$parent.$eval(a.filter)||"",e.updateVisibleData()}),e.$watch(a.multiselect,function(){e.multiselect=void 0==a.multiselect||"true"==a.multiselect}),e.$watch(a.pager,function(){e.showPager=void 0==a.pager||"true"==a.pager,e.showPager||(e.itemsPerPage=1e13)}),e.$watch(a.height,function(){e.$parent.$watch(a.height,function(){e.height=e.$parent.$eval(a.height)||e.height}),e.height=e.$parent.$eval(a.height)||e.height}),e.$watch(a.width,function(){e.$parent.$watch(a.width,function(){e.width=e.$parent.$eval(a.width)||e.width}),e.width=e.$parent.$eval(a.width)||e.width})}],template:'<div>		<style>		.rectNG {margin: 0; padding: 0 0 79px; display: block; outline: none; user-select: none; -ms-user-select: none; -moz-user-select: none; -webkit-user-select: none;}		/* Header */ 		.rectNG > div.rectNG-head {display: table;width: 100%;border-bottom: 2px solid #ccc;}		.rectNG > div.rectNG-head > div:first-child {display: table-row;height: 38px;cursor: pointer;}		.rectNG-title {display: table-cell;color:#555;font-size: 16px;font-weight: bold;vertical-align: middle;padding: 3px 6px;}		/* Body */ 		.rectNG > .rectNG-body {width: 100%;height: 100%;overflow: auto;display: block;}		.rectNG > .rectNG-body > .rectNG-inner{display: table;width: 100%;}		.rectNG-inner > .rectNG-row {display: table-row;width: 100%;height: 33px;cursor: pointer;}		.rectNG-inner > .rectNG-row:nth-child(2n) {background-color: #fefefe;}		.rectNG-inner > .rectNG-row:nth-child(2n+1) {background-color: #f9f9f9;}		.rectNG-inner > .rectNG-row:hover {background-color: #eee;}		.rectNG-row > .rectNG-cell {display: table-cell;vertical-align: middle;padding: 3px 6px;}		/* Footer */ 		.rectNG > .rectNG-footer {width: 100%; height: 35px; border-top: 2px solid #ccc;}		.rectNG > .rectNG-footer > .rectNG-pager {float: right; padding-top: 12px;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-page {display:table-cell;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-page > span {padding: 4px 8px; background-color: #f9f9f9;cursor: pointer;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-page > span:hover {background-color: #ddd;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-page > .rectNG-pageinput {width: 50px; height: 20px; margin: 0; border: 0; font-size: 14px; text-align: center; outline: none; user-select: none; -ms-user-select: none; -moz-user-select: none; -webkit-user-select: none;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-entries {display:table-cell;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-entries > span {margin-right: 20px; padding: 4px 20px; background-color: #f9f9f9;cursor: pointer;}		.rectNG > .rectNG-footer > .rectNG-pager > .rectNG-entries > span:hover {background-color: #ddd;}		/* Selected */ 		div.rectNG-row.rectNG-selected {background-color: #ddd !important;}		</style>						<div class="rectNG" tabindex="10000" style="width: {{width}}; height: {{height}}; padding: {{showPager ? \'0 0 79px\' : \'0 0 44px\'}}; " ng-init="init()" ng-keydown="onKey($event)">			<div class="rectNG-head">				<div>					<div class="rectNG-title" ng-repeat="c in visibleModel" style="width: {{columnWidth()}};" ng-click="sortBy($index)">{{c.title}} <span ng-show="lastSortIndex==$index && sortAscending">&darr;</span><span ng-show="lastSortIndex==$index && !sortAscending">&uarr;</span></div>				</div>			</div>			<div class="rectNG-body">				<div class="rectNG-inner">					<div class="rectNG-row" ng-repeat="row in visibleData" ng-click="cellClick($index, $event)" ng-class="isRowSelected($index)">						<div class="rectNG-cell" ng-repeat="c in visibleModel" style="width: {{columnWidth()}};">{{row[c.id]}}</div>					</div>				</div>			</div>			<div class="rectNG-footer" ng-show="showPager">				<div class="rectNG-pager">					<div class="rectNG-entries"><span class="arrow" ng-click="toggleItemsPerPage()">{{itemsPerPage}}</span></div>					<div class="rectNG-page"><span class="arrow" ng-click="prevPage()">&larr;</span></div>					<div class="rectNG-page">						<span ng-show="!showPageInputBox" ng-click="toggleGotoPage($event)">{{currentPage + \' / \' + countPages()}}</span>						<input class="rectNG-pageinput" ng-show="showPageInputBox" ng-keydown="toggleGotoPage($event)" ng-blur="toggleGotoPage($event)" ng-model="currentPage" type="text"></input>					</div>					<div class="rectNG-page"><span class="arrow" ng-click="nextPage()">&rarr;</span></div>				</div>			</div>		</div>',replace:!0}});